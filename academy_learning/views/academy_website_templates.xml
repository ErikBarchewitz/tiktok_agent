<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="course_portal" name="Academy Learning Course Portal">
        <t t-call="website.layout">
            <div class="o_academy_course_wrapper">
                <div class="o_academy_course_hero">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-7">
                                <h1 class="display-4" t-esc="course.name"/>
                                <p class="lead" t-esc="course.tagline or ''"/>
                                <t t-if="not enrollment">
                                    <p class="text-muted">
                                        Melde dich mit deinem Namen und deiner E-Mail-Adresse an, um direkt mit dem Kurs zu starten.
                                    </p>
                                </t>
                                <t t-else="">
                                    <p class="text-muted">
                                        Willkommen zurück, <span t-esc="enrollment.partner_id.name"/>! Dein Fortschritt beträgt
                                        <strong><span t-esc="int(enrollment.progress)"/>%</strong>.
                                    </p>
                                </t>
                            </div>
                            <div class="col-lg-5 text-center">
                                <t t-if="course.cover_image">
                                    <img t-att-src="'/web/image/academy.course/' + str(course.id) + '/cover_image'" alt="Course cover" class="img-fluid rounded shadow"/>
                                </t>
                                <t t-else="">
                                    <div class="o_academy_course_placeholder">Academy Learning</div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container my-5">
                    <t t-if="not enrollment">
                        <div class="row justify-content-center">
                            <div class="col-lg-6">
                                <div class="card shadow-sm">
                                    <div class="card-body p-4">
                                        <h3 class="card-title">Jetzt anmelden</h3>
                                        <form t-att-action="'/academy/%s/register' % course.token" method="post" class="o_academy_register">
                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                            <div class="mb-3">
                                                <label class="form-label">Name</label>
                                                <input class="form-control" name="name" required="required" placeholder="Max Mustermann"/>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">E-Mail</label>
                                                <input class="form-control" name="email" type="email" required="required" placeholder="max@example.com"/>
                                            </div>
                                            <button class="btn btn-primary w-100" type="submit">Kurs starten</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>

                    <t t-if="enrollment">
                        <div class="row g-4">
                            <div class="col-lg-8">
                                <section class="o_academy_section" id="lessons">
                                    <div class="d-flex align-items-center justify-content-between mb-3">
                                        <h2 class="h4 mb-0">Lektionen</h2>
                                        <span class="badge bg-primary rounded-pill" t-esc="len(lessons)"/>
                                    </div>
                                    <t t-if="not lessons">
                                        <p class="text-muted">Für diesen Kurs wurden noch keine Lektionen hinterlegt.</p>
                                    </t>
                                    <t t-foreach="lessons" t-as="lesson">
                                        <div class="card o_academy_lesson" t-att-id="'lesson-%s' % lesson.id">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h3 class="h5 mb-1" t-esc="lesson.name"/>
                                                        <t t-if="lesson.duration_minutes">
                                                            <span class="badge bg-light text-dark"><i class="fa fa-clock me-1"></i><span t-esc="lesson.duration_minutes"/> Minuten</span>
                                                        </t>
                                                    </div>
                                                    <t t-set="completed" t-value="lesson.id in enrollment.lesson_progress_ids.mapped('lesson_id').ids"/>
                                                    <form t-att-action="'/academy/%s/lesson/%s/complete' % (course.token, lesson.id)" method="post" class="o_academy_lesson_complete">
                                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                        <input type="hidden" name="enrollment_token" t-att-value="enrollment.access_token"/>
                                                        <button t-attf-class="btn btn-sm {{'btn-success' if completed else 'btn-outline-primary'}}" t-att-disabled="completed and 'disabled'">
                                                            <i t-attf-class="fa {{'fa-check' if completed else 'fa-flag'}} me-1"></i>
                                                            <t t-if="completed">Abgeschlossen</t>
                                                            <t t-else="">Abschließen</t>
                                                        </button>
                                                    </form>
                                                </div>
                                                <hr/>
                                                <div class="o_academy_lesson_content" t-raw="lesson.content or ''"/>
                                                <t t-if="lesson.resource_url">
                                                    <a t-att-href="lesson.resource_url" class="btn btn-link mt-3" target="_blank">Zusätzliche Ressourcen</a>
                                                </t>
                                            </div>
                                        </div>
                                    </t>
                                </section>

                                <section class="o_academy_section mt-5" id="quizzes">
                                    <div class="d-flex align-items-center justify-content-between mb-3">
                                        <h2 class="h4 mb-0">Quizze</h2>
                                        <span class="badge bg-secondary rounded-pill" t-esc="len(quizzes)"/>
                                    </div>
                                    <t t-if="not quizzes">
                                        <p class="text-muted">Dieser Kurs enthält aktuell keine Quizze.</p>
                                    </t>
                                    <t t-foreach="quizzes" t-as="quiz">
                                        <div class="card o_academy_quiz" t-att-id="'quiz-%s' % quiz.id">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h3 class="h5" t-esc="quiz.name"/>
                                                        <span class="text-muted small">Bestehensgrenze: <t t-esc="quiz.passing_score"/>%</span>
                                                    </div>
                                                </div>
                                                <div class="mt-3" t-raw="quiz.introduction or ''"/>
                                                <form t-att-action="'/academy/%s/quiz/%s/submit' % (course.token, quiz.id)" method="post" class="o_academy_quiz_form mt-4">
                                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                    <input type="hidden" name="enrollment_token" t-att-value="enrollment.access_token"/>
                                                    <t t-foreach="quiz.question_ids" t-as="question">
                                                        <div class="o_academy_question mb-4">
                                                            <h4 class="h6" t-esc="question.name"/>
                                                            <t t-if="question.question_type in ('single', 'multiple')">
                                                                <div class="o_academy_answers">
                                                                    <t t-foreach="question.answer_ids" t-as="answer">
                                                                        <div class="form-check">
                                                                            <t t-if="question.question_type == 'single'">
                                                                                <input class="form-check-input" type="radio" t-att-name="'question_%s' % question.id" t-att-value="str(answer.id)" t-att-id="'answer-%s' % answer.id"/>
                                                                            </t>
                                                                            <t t-else="">
                                                                                <input class="form-check-input" type="checkbox" t-att-name="'question_%s' % question.id" t-att-value="str(answer.id)" t-att-id="'answer-%s' % answer.id"/>
                                                                            </t>
                                                                            <label class="form-check-label" t-att-for="'answer-%s' % answer.id" t-esc="answer.name"/>
                                                                        </div>
                                                                    </t>
                                                                </div>
                                                            </t>
                                                            <t t-elif="question.question_type == 'text'">
                                                                <textarea class="form-control" rows="3" t-att-name="'question_%s' % question.id" placeholder="Deine Antwort"></textarea>
                                                            </t>
                                                        </div>
                                                    </t>
                                                    <button class="btn btn-outline-secondary" type="submit">Antworten prüfen</button>
                                                </form>
                                            </div>
                                        </div>
                                    </t>
                                </section>
                            </div>
                            <div class="col-lg-4">
                                <aside class="o_academy_sidebar">
                                    <div class="card shadow-sm">
                                        <div class="card-body">
                                            <h3 class="h5">Kursüberblick</h3>
                                            <ul class="list-unstyled small mb-4">
                                                <li><i class="fa fa-book me-2 text-primary"></i><strong t-esc="len(lessons)"/> Lektionen</li>
                                                <li><i class="fa fa-question-circle me-2 text-primary"></i><strong t-esc="len(quizzes)"/> Quizze</li>
                                                <li><i class="fa fa-link me-2 text-primary"></i><a t-att-href="course.access_url" target="_blank">Kurslink teilen</a></li>
                                            </ul>
                                            <div class="progress mb-3">
                                                <div class="progress-bar" role="progressbar" t-att-style="'width: %s%%' % enrollment.progress" t-att-aria-valuenow="enrollment.progress" aria-valuemin="0" aria-valuemax="100">
                                                    <t t-esc="int(enrollment.progress)"/>%
                                                </div>
                                            </div>
                                            <t t-if="enrollment.quiz_score">
                                                <div class="alert alert-success" role="alert">
                                                    Letzte Quizbewertung: <strong><t t-esc="round(enrollment.quiz_score, 2)"/>%</strong>
                                                </div>
                                            </t>
                                            <h4 class="h6 mt-4">Beschreibung</h4>
                                            <div class="o_academy_description" t-raw="course.description or ''"/>
                                        </div>
                                    </div>
                                </aside>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>
</odoo>
